"use strict";!function(e){var r=e.module("appModule",["ngRoute"],["$httpProvider",function(r){r.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var n=function t(e){var r,n,o,i,a,c,s,l="";for(r in e)if(n=e[r],n instanceof Array)for(s=0;s<n.length;++s)a=n[s],o=r+"["+s+"]",c={},c[o]=a,l+=t(c)+"&";else if(n instanceof Object)for(i in n)a=n[i],o=r+"["+i+"]",c={},c[o]=a,l+=t(c)+"&";else void 0!==n&&null!==n&&(l+=encodeURIComponent(r)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l};r.defaults.transformRequest=[function(r){return e.isObject(r)&&"[object File]"!==String(r)?n(r):r}]}]);r.factory("ipcService",["$http","$q",function(e,r){return{positions:function(n){n=isNaN(parseInt(n))?1:parseInt(n);var t=r.defer();return e.post("/api/admin/query",{field:["positionId","haveProduct"],from:"positions",pagination:40,page:n}).success(function(e){t.resolve(JSON.parse(e).list)}).error(function(e){t.reject(e)}),t.promise},positionPages:function(){var n=r.defer();return e.post("/api/admin/maxPages",{pagination:40}).success(function(e){n.resolve(JSON.parse(e))}).error(function(e){n.reject(e)}),n.promise},unnoticedOrders:function(n){var t=r.defer();return e.post("/api/admin/query",{where:[{key:"haveNoticed",value:0}],field:["orderId","usrPhoneNumber"],from:"orders",pagination:20,page:n}).success(function(e){t.resolve(JSON.parse(e).list)}).error(function(e){t.reject(e)}),t.promise},order:function(n){var t=r.defer();return e.post("/api/admin/query",{where:[{key:"orderId",value:n}],field:["orderId","usrPhoneNumber","orderInfo","usrId","positionId","importTime","exportTime"],from:"orders"}).success(function(e){var r=JSON.parse(e);1==r.status?t.resolve(r.list):2==r.status&&t.resolve({response:r.response,failed:!0})}).error(function(e){t.reject(e)}),t.promise},usr:function(n){var t=r.defer();return e.post("/api/admin/query",{where:[{key:"name",value:n}],field:["id","usrPhoneNumber","psw","lastIp","name","lastLogin"],from:"usr"}).success(function(e){t.resolve(JSON.parse(e))}).error(function(e){t.reject(e)}),t.promise},adminName:function(){var n=r.defer();return e.post("/api/admin/getRootName",{}).success(function(e){n.resolve(JSON.parse(e).name)}).error(function(e){n.reject(e)}),n.promise}}}]),r.config(["$routeProvider",function(e){e.when("/",{controller:"IndexController",templateUrl:"/tpl/admin/index.html"}).when("/index",{controller:"IndexController",templateUrl:"/tpl/admin/index.html"}).when("/containerStatus",{controller:"containerStatusController",templateUrl:"/tpl/admin/containerStatus.html"}).when("/unnoticed",{controller:"unnoticedController",templateUrl:"/tpl/admin/unnoticed.html"}).when("/backOrder",{controller:"backOrderController",templateUrl:"/tpl/admin/backOrder.html"}).when("/usrStatus",{controller:"usrStatusController",templateUrl:"/tpl/admin/usrStatus.html"}).when("/usrOrder",{controller:"usrOrderController",templateUrl:"/tpl/admin/usrOrder.html"}).when("/orderConf",{controller:"orderConfController",templateUrl:"/tpl/admin/orderConf.html"})}]);r.controller("containerStatusController",["$scope","ipcService",function(e,r){e.nowPage="1";var n=function(){r.positions(e.nowPage).then(function(r){e.positions=r}),r.positionPages(e.nowPage).then(function(r){e.pages=r})};e.$watch("nowPage",n)}]),r.controller("msgController",["$scope","ipcService",function(e,r){e.username="root",r.adminName().then(function(r){e.username=r})}]),r.controller("unnoticedController",["$scope","ipcService",function(e,r){e.datahave=!1,e.nowPage="1";var n=function(){r.unnoticedOrders(e.nowPage).then(function(r){e.unnoticedOrders=r,e.datahave=parseInt(r.lenght)>0})};e.$watch("nowPage",n)}]),r.controller("backOrderController",["$scope",function(e){}]),r.controller("usrStatusController",["$scope","ipcService",function(e,r){e.datahave=!1;var n=function(){r.usr(e.usrid).then(function(r){e.usr=r.list,e.datahave=parseInt(r.lenght)>0})};e.$watch("usrid",n)}]),r.controller("usrOrderController",["$scope","ipcService","$http",function(e,r,n){e.orderid="",e.datahave=!1;var t=function(){r.order(e.nowPage).then(function(r){e.order=r})};e.$watch("orderid",function(e){var r=/\b\d{12}\b/g;null!==e.toString().match(r)&&t()})}]),r.controller("orderConfController",["$scope","ipcService","$http",function(e,r,n){e.datahave=!1;var t=function(){r.order(e.orderid).then(function(r){e.datahave=parseInt(r.lenght)>0,e.order=r[0]})};e.$watch("orderid",t),e.edit=function(e){r.order().then(function(e){}),t()}}]),r.controller("IndexController",["$scope",function(e){}])}(angular);